(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{1170:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return B}});var r=n(5893),o=n(809),a=n.n(o),u=n(2447),c=n(7294),i=n(1163),s=n(9008),p=n(9669),f=n.n(p),l=n(1752),d=((0,l.default)()||{}).publicRuntimeConfig,h=(void 0===d?{}:d).sso_url,v="".concat(h,"/.well-known/openid-configuration"),_={},g=function(){var e=(0,u.Z)(a().mark((function e(){var t,n,r,o,u;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f().get(v).then((function(e){return e.data}),(function(){return null}));case 2:t=e.sent,n=t.authorization_endpoint,r=t.token_endpoint,o=t.jwks_uri,u=t.userinfo_endpoint,Object.assign(_,{authorization_endpoint:n,token_endpoint:r,jwks_uri:o,userinfo_endpoint:u});case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),k=n(129),w=n.n(k),x=n(9227),b=function(e){if(!e)return null;var t=e.replace(/-/g,"+").replace(/_/g,"/"),n=atob(t),r=Array.from(n).reduce((function(e,t){var n=("00"+t.charCodeAt(0).toString(16)).slice(-2);return"".concat(e,"%").concat(n)}),""),o=decodeURIComponent(r);return JSON.parse(o)},m=function(e){if(!e)return null;var t=e.split("."),n=(0,x.Z)(t,3),r=(n[0],n[1]);n[2];return b(r)},y=function(e){if(!e)return null;var t=e.split("."),n=(0,x.Z)(t,3),r=n[0];n[1],n[2];return b(r)},S=function(){var e=new Uint32Array(28);crypto.getRandomValues(e);var t=[];return e.forEach((function(e){return t.push("0".concat(e.toString(16).substr(-2)))})),t.reduce((function(e,t){return"".concat(e).concat(t)}),"")},j=function(){var e=(0,u.Z)(a().mark((function e(t){var n,r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"SHA-256",n=new TextEncoder,r=n.encode(t),e.abrupt("return",crypto.subtle.digest("SHA-256",r));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),C=function(e){var t=new Uint8Array(e).reduce((function(e,t){return"".concat(e).concat(String.fromCharCode(t))}),"");return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")},Z=((0,l.default)()||{}).publicRuntimeConfig,I=void 0===Z?{}:Z,R=I.sso_client_id,E=I.sso_authorization_scope,N=I.sso_authorization_response_type,O=I.sso_redirect_uri,A=I.sso_token_grant_type,J=function(){var e=(0,u.Z)(a().mark((function e(){var t,n,r,o,u;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=S(),sessionStorage.setItem("pkce_state",t),n=S(),sessionStorage.setItem("code_verifier",n),e.next=6,j(n);case 6:return r=e.sent,o=C(r),sessionStorage.setItem("code_challenge",o),u={client_id:R,response_type:N,redirect_uri:O,scope:E,state:t,code_challenge_method:"S256",code_challenge:o},e.abrupt("return","".concat(_.authorization_endpoint,"?").concat(w().stringify(u,{encode:!1})));case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),z=function(){var e=(0,u.Z)(a().mark((function e(t){var n,r,o,u,c,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.code,r=t.state,sessionStorage.getItem("pkce_state")===r){e.next=4;break}return console.error("invalid state"),e.abrupt("return",null);case 4:return o=sessionStorage.getItem("code_verifier"),u={grant_type:A,client_id:R,redirect_uri:O,code:n,code_verifier:o},c="".concat(_.token_endpoint),i={url:c,method:"post",data:w().stringify(u)},e.abrupt("return",f()(i).then((function(e){return e.data}),console.error));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),U=n(1166),T=((0,l.default)()||{}).publicRuntimeConfig,L=(void 0===T?{}:T).sso_client_id,H=function(){var e=(0,u.Z)(a().mark((function e(t){var n,r,o,u,c,i,s;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="".concat(_.jwks_uri),e.next=3,f().get(n).then((function(e){return e.data}),console.error);case 3:if(r=e.sent,o=null===r||void 0===r?void 0:r.keys,u=y(t),void 0!==(c=o.find((function(e){return e.kid===u.kid})))){e.next=10;break}return console.error("public key not found in JWK jwks.json"),e.abrupt("return",!1);case 10:if(i=U.KZ.getKey(c),U.fs.jws.JWS.verifyJWT(t,i,{alg:["RS256"]})){e.next=15;break}return console.error("signature verification failed"),e.abrupt("return",!1);case 15:if(s=m(t),!(Date.now()>=1e3*s.exp)){e.next=19;break}return console.error("token expired"),e.abrupt("return",!1);case 19:if(0===s.aud.localeCompare(L)){e.next=23;break}return console.error("token was not issued for this audience"),e.abrupt("return",!1);case 23:return e.abrupt("return",s);case 24:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),K=((0,l.default)()||{}).publicRuntimeConfig,P=(void 0===K?{}:K).apiUrl,W=f().create({baseURL:"".concat(P,"/"),timeout:0,withCredentials:!0}),q="tokens";function D(){return F.apply(this,arguments)}function F(){return(F=(0,u.Z)(a().mark((function e(){var t,n,r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=JSON.parse(sessionStorage.getItem(q)||"")||{},n={headers:{Authorization:"Bearer ".concat(t.id_token)}},e.next=5,W.get("/api/info",n).then((function(e){return e.data}));case 5:return r=e.sent,e.abrupt("return",r);case 9:return e.prev=9,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",null);case 13:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}var X="tokens";function B(){var e=(0,i.useRouter)(),t=(0,c.useState)(null),n=t[0],o=t[1],p=(0,c.useState)(null),f=(p[0],p[1]);(0,c.useEffect)((function(){function t(){return(t=(0,u.Z)(a().mark((function t(){var n,r,u,c,i,s,p;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,g();case 3:if(n=new URLSearchParams(window.location.search),r=n.get("code"),u=n.get("state")||"",!r){t.next=16;break}return t.next=9,z({code:r,state:u});case 9:return c=t.sent,t.next=12,H(c.id_token);case 12:(i=t.sent)&&(sessionStorage.setItem(X,JSON.stringify(c)),o(i),e.push("/")),t.next=26;break;case 16:return s=JSON.parse(sessionStorage.getItem(X)||""),t.next=19,H(s.id_token);case 19:if(!(p=t.sent)){t.next=24;break}return t.abrupt("return",o(p));case 24:sessionStorage.removeItem(X),l();case 26:t.next=31;break;case 28:t.prev=28,t.t0=t.catch(0),f(t.t0);case 31:case"end":return t.stop()}}),t,null,[[0,28]])})))).apply(this,arguments)}!function(){t.apply(this,arguments)}()}),[]);var l=function(){var t=(0,u.Z)(a().mark((function t(){var n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,J();case 2:n=t.sent,e.push(n);case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),d=function(){var t=(0,u.Z)(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:sessionStorage.removeItem(X),e.reload();case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),h=function(){var e=(0,u.Z)(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D();case 2:t=e.sent,console.log(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(s.default,{children:[(0,r.jsx)("title",{children:"SSO Requests"}),(0,r.jsx)("meta",{name:"description",content:"The request process workflow tool for the RedHat SSO Dev Exchange service"}),(0,r.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,r.jsx)("main",{children:n?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{type:"button",onClick:d,children:"Logout"}),(0,r.jsx)("button",{type:"button",onClick:h,children:"Info"})]}):(0,r.jsx)("button",{type:"button",onClick:l,children:"Login"})}),(0,r.jsx)("footer",{})]})}},5301:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(1170)}])},4654:function(){}},function(e){e.O(0,[332,449,774,888,179],(function(){return t=5301,e(e.s=t);var t}));var t=e.O();_N_E=t}]);