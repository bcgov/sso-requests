(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8833:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return X}});var r=n(5893),o=n(809),a=n.n(o),u=n(2447),i=n(7294),c=n(1163),s=n(9008),f=n(1752),p=n(9669),l=n.n(p),d=((0,f.default)()||{}).publicRuntimeConfig,h=(void 0===d?{}:d).sso_url,v="".concat(h,"/.well-known/openid-configuration"),_={},g=function(){var e=(0,u.Z)(a().mark((function e(){var t,n,r,o,u;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l().get(v).then((function(e){return e.data}),(function(){return null}));case 2:t=e.sent,n=t.authorization_endpoint,r=t.token_endpoint,o=t.jwks_uri,u=t.userinfo_endpoint,Object.assign(_,{authorization_endpoint:n,token_endpoint:r,jwks_uri:o,userinfo_endpoint:u});case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),k=n(129),w=n.n(k),x=n(9227),b=function(e){if(!e)return null;var t=e.replace(/-/g,"+").replace(/_/g,"/"),n=atob(t),r=Array.from(n).reduce((function(e,t){var n=("00"+t.charCodeAt(0).toString(16)).slice(-2);return"".concat(e,"%").concat(n)}),""),o=decodeURIComponent(r);return JSON.parse(o)},m=function(e){if(!e)return null;var t=e.split("."),n=(0,x.Z)(t,3),r=(n[0],n[1]);n[2];return b(r)},y=function(e){if(!e)return null;var t=e.split("."),n=(0,x.Z)(t,3),r=n[0];n[1],n[2];return b(r)},S=function(){var e=new Uint32Array(28);crypto.getRandomValues(e);var t=[];return e.forEach((function(e){return t.push("0".concat(e.toString(16).substr(-2)))})),t.reduce((function(e,t){return"".concat(e).concat(t)}),"")},j=function(){var e=(0,u.Z)(a().mark((function e(t){var n,r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"SHA-256",n=new TextEncoder,r=n.encode(t),e.abrupt("return",crypto.subtle.digest("SHA-256",r));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),C=function(e){var t=new Uint8Array(e).reduce((function(e,t){return"".concat(e).concat(String.fromCharCode(t))}),"");return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")},R=((0,f.default)()||{}).publicRuntimeConfig,Z=void 0===R?{}:R,I=Z.sso_client_id,E=Z.sso_authorization_scope,N=Z.sso_authorization_response_type,O=Z.sso_redirect_uri,A=Z.sso_token_grant_type,J=function(){var e=(0,u.Z)(a().mark((function e(){var t,n,r,o,u;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=S(),sessionStorage.setItem("pkce_state",t),n=S(),sessionStorage.setItem("code_verifier",n),e.next=6,j(n);case 6:return r=e.sent,o=C(r),sessionStorage.setItem("code_challenge",o),u={client_id:I,response_type:N,redirect_uri:O,scope:E,state:t,code_challenge_method:"S256",code_challenge:o},e.abrupt("return","".concat(_.authorization_endpoint,"?").concat(w().stringify(u,{encode:!1})));case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),z=function(){var e=(0,u.Z)(a().mark((function e(t){var n,r,o,u,i,c;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.code,r=t.state,sessionStorage.getItem("pkce_state")===r){e.next=4;break}return console.error("invalid state"),e.abrupt("return",null);case 4:return o=sessionStorage.getItem("code_verifier"),u={grant_type:A,client_id:I,redirect_uri:O,code:n,code_verifier:o},i="".concat(_.token_endpoint),c={url:i,method:"post",data:w().stringify(u)},e.abrupt("return",l()(c).then((function(e){return e.data}),console.error));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),T=n(1166),U=((0,f.default)()||{}).publicRuntimeConfig,L=(void 0===U?{}:U).sso_client_id,H=function(){var e=(0,u.Z)(a().mark((function e(t){var n,r,o,u,i,c,s;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="".concat(_.jwks_uri),e.next=3,l().get(n).then((function(e){return e.data}),console.error);case 3:if(r=e.sent,o=null===r||void 0===r?void 0:r.keys,u=y(t),void 0!==(i=o.find((function(e){return e.kid===u.kid})))){e.next=10;break}return console.error("public key not found in JWK jwks.json"),e.abrupt("return",!1);case 10:if(c=T.KZ.getKey(i),T.fs.jws.JWS.verifyJWT(t,c,{alg:["RS256"]})){e.next=15;break}return console.error("signature verification failed"),e.abrupt("return",!1);case 15:if(s=m(t),!(Date.now()>=1e3*s.exp)){e.next=19;break}return console.error("token expired"),e.abrupt("return",!1);case 19:if(0===s.aud.localeCompare(L)){e.next=23;break}return console.error("token was not issued for this audience"),e.abrupt("return",!1);case 23:return e.abrupt("return",s);case 24:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),K=n(513),P="tokens";function W(){return q.apply(this,arguments)}function q(){return(q=(0,u.Z)(a().mark((function e(){var t,n,r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=JSON.parse(sessionStorage.getItem(P)||"")||{},n={headers:{Authorization:"Bearer ".concat(t.id_token)}},e.next=5,K.e.get("/api/info",n).then((function(e){return e.data}));case 5:return r=e.sent,e.abrupt("return",r);case 9:return e.prev=9,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",null);case 13:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}var D=((0,f.default)()||{}).publicRuntimeConfig,F=((void 0===D?{}:D).app_url,"tokens");function X(){var e=(0,c.useRouter)(),t=(0,i.useState)(null),n=t[0],o=t[1],f=(0,i.useState)(null),p=(f[0],f[1]);(0,i.useEffect)((function(){function t(){return(t=(0,u.Z)(a().mark((function t(){var n,r,u,i,c,s,f;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,g();case 3:if(n=new URLSearchParams(window.location.search),r=n.get("code"),u=n.get("state")||"",!r){t.next=16;break}return t.next=9,z({code:r,state:u});case 9:return i=t.sent,t.next=12,H(i.id_token);case 12:(c=t.sent)&&(sessionStorage.setItem(F,JSON.stringify(i)),o(c),e.push("/")),t.next=26;break;case 16:return s=JSON.parse(sessionStorage.getItem(F)||""),t.next=19,H(s.id_token);case 19:if(!(f=t.sent)){t.next=24;break}return t.abrupt("return",o(f));case 24:sessionStorage.removeItem(F),l();case 26:t.next=31;break;case 28:t.prev=28,t.t0=t.catch(0),p(t.t0);case 31:case"end":return t.stop()}}),t,null,[[0,28]])})))).apply(this,arguments)}!function(){t.apply(this,arguments)}()}),[]);var l=function(){var e=(0,u.Z)(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,J();case 2:t=e.sent,window.location.href=t;case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),d=function(){var t=(0,u.Z)(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:sessionStorage.removeItem(F),e.reload();case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),h=function(){var e=(0,u.Z)(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W();case 2:t=e.sent,console.log(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(s.default,{children:[(0,r.jsx)("title",{children:"SSO Requests"}),(0,r.jsx)("meta",{name:"description",content:"The request process workflow tool for the RedHat SSO Dev Exchange service"}),(0,r.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,r.jsxs)("main",{children:[n?(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("button",{type:"button",onClick:d,children:"Logout"})}):(0,r.jsx)("button",{type:"button",onClick:l,children:"Login"}),(0,r.jsx)("button",{type:"button",onClick:h,children:"Check Server Auth"})]}),(0,r.jsx)("footer",{})]})}},513:function(e,t,n){"use strict";n.d(t,{e:function(){return c}});var r=n(1752),o=n(9669),a=n.n(o),u=((0,r.default)()||{}).publicRuntimeConfig,i=(void 0===u?{}:u).api_url,c=a().create({baseURL:"".concat(i,"/"),timeout:0,withCredentials:!0})},5301:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(8833)}])},4654:function(){}},function(e){e.O(0,[332,559,478,774,888,179],(function(){return t=5301,e(e.s=t);var t}));var t=e.O();_N_E=t}]);